(()=>{var ze=["white","black"];var V=["a","b","c","d","e","f","g","h"],Z=["1","2","3","4","5","6","7","8"];var He=[...Z].reverse(),Y=V.flatMap(e=>Z.map(o=>e+o)),$=e=>e.every(o=>o>=0&&o<=7)?Y[8*e[0]+e[1]]:void 0,z=e=>$(e),h=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49];var ge=Y.map(h),Ie=Y.map((e,o)=>({key:e,pos:ge[o]}));function be(e){let o,r=()=>(o===void 0&&(o=e()),o);return r.clear=()=>{o=void 0},r}var je=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;let o=performance.now()-e;return e=void 0,o}}},F=e=>e==="white"?"black":"white",H=(e,o)=>(e[0]-o[0])**2+(e[1]-o[1])**2,Q=(e,o)=>e.role===o.role&&e.color===o.color,Ve=(e,o)=>e[0]===o[0]&&e[1]===o[1],I=e=>(o,r)=>[(r?o[0]:7-o[0])*e.width/8,(r?7-o[1]:o[1])*e.height/8],C=(e,o)=>{e.style.transform=`translate(${o[0]}px,${o[1]}px)`},ve=(e,o,r=1)=>{e.style.transform=`translate(${o[0]}px,${o[1]}px) scale(${r})`},B=(e,o)=>{e.style.visibility=o?"visible":"hidden"},O=e=>{if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(e.targetTouches?.[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},or=be(()=>!("ontouchstart"in window)&&["macintosh","firefox"].every(e=>navigator.userAgent.toLowerCase().includes(e))),te=e=>e.button===2&&!(e.ctrlKey&&or()),M=(e,o)=>{let r=document.createElement(e);return o&&(r.className=o),r};function ie(e,o,r){let n=h(e);return o||(n[0]=7-n[0],n[1]=7-n[1]),[r.left+r.width*n[0]/8+r.width/16,r.top+r.height*(7-n[1])/8+r.height/16]}var N=(e,o)=>Math.abs(e-o),se=(e,o,r,n)=>N(e,r)*N(o,n)===2,we=(e,o,r,n)=>e===r!=(o===n),ye=(e,o,r,n)=>N(e,r)===N(o,n)&&e!==r,Ge=(e,o,r,n)=>we(e,o,r,n)||ye(e,o,r,n),Ze=(e,o,r,n)=>Math.max(N(e,r),N(o,n))===1;var _e=(e,o,r,n,t)=>{let i=t?1:-1;return e===r&&(n===o+i||n===o+2*i&&(t?o<=1:o>=6))},Ue=(e,o,r,n)=>{let t=r-e,i=n-o;if(t&&i&&Math.abs(t)!==Math.abs(i))return[];let c=Math.sign(t),p=Math.sign(i),d=[],s=e+c,l=o+p;for(;s!==r||l!==n;)d.push([s,l]),s+=c,l+=p;return d.map($).filter(a=>a!==void 0)};var rr=e=>N(e.orig.pos[0],e.dest.pos[0])<=1&&(N(e.orig.pos[0],e.dest.pos[0])===1?e.dest.pos[1]===e.orig.pos[1]+(e.color==="white"?1:-1):_e(...e.orig.pos,...e.dest.pos,e.color==="white")),nr=e=>se(...e.orig.pos,...e.dest.pos),Xe=e=>ye(...e.orig.pos,...e.dest.pos),Ye=e=>we(...e.orig.pos,...e.dest.pos),tr=e=>Xe(e)||Ye(e),ir=e=>Ze(...e.orig.pos,...e.dest.pos)||e.orig.pos[1]===e.dest.pos[1]&&e.orig.pos[1]===(e.color==="white"?0:7)&&(e.orig.pos[0]===4&&(e.dest.pos[0]===2&&e.rookFilesFriendlies.includes(0)||e.dest.pos[0]===6&&e.rookFilesFriendlies.includes(7))||e.rookFilesFriendlies.includes(e.dest.pos[0])),sr={pawn:rr,knight:nr,bishop:Xe,rook:Ye,queen:tr,king:ir};function Pe(e,o){let r=e.pieces,n=r.get(o);if(!n||n.color===e.turnColor)return[];let t=n.color,i=new Map([...r].filter(([l,a])=>a.color===t)),c=new Map([...r].filter(([l,a])=>a.color===F(t))),p={key:o,pos:h(o)},d=l=>sr[n.role](l)&&e.premovable.additionalPremoveRequirements(l),s={orig:p,role:n.role,allPieces:r,friendlies:i,enemies:c,color:t,rookFilesFriendlies:Array.from(r).filter(([l,a])=>l[1]===(t==="white"?"1":"8")&&a.color===t&&a.role==="rook").map(([l])=>h(l)[0]),lastMove:e.lastMove};return Ie.filter(l=>d({...s,dest:l})).map(l=>l.key)}function k(e,...o){e&&setTimeout(()=>e(...o),1)}function Qe(e){e.orientation=F(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Je(e,o){for(let[r,n]of o)n?e.pieces.set(r,n):e.pieces.delete(r)}function eo(e,o){if(e.check=void 0,o===!0&&(o=e.turnColor),o)for(let[r,n]of e.pieces)n.role==="king"&&n.color===o&&(e.check=r)}function cr(e,o,r,n){A(e),e.premovable.current=[o,r],k(e.premovable.events.set,o,r,n)}function D(e){e.premovable.current&&(e.premovable.current=void 0,k(e.premovable.events.unset))}function lr(e,o,r){D(e),e.predroppable.current={role:o,key:r},k(e.predroppable.events.set,o,r)}function A(e){let o=e.predroppable;o.current&&(o.current=void 0,k(o.events.unset))}function ar(e,o,r){if(!e.autoCastle)return!1;let n=e.pieces.get(o);if(!n||n.role!=="king")return!1;let t=h(o),i=h(r);if(t[1]!==0&&t[1]!==7||t[1]!==i[1])return!1;t[0]===4&&!e.pieces.has(r)&&(i[0]===6?r=z([7,i[1]]):i[0]===2&&(r=z([0,i[1]])));let c=e.pieces.get(r);return!c||c.color!==n.color||c.role!=="rook"?!1:(e.pieces.delete(o),e.pieces.delete(r),t[0]<i[0]?(e.pieces.set(z([6,i[1]]),n),e.pieces.set(z([5,i[1]]),c)):(e.pieces.set(z([2,i[1]]),n),e.pieces.set(z([3,i[1]]),c)),!0)}function ke(e,o,r){let n=e.pieces.get(o),t=e.pieces.get(r);if(o===r||!n)return!1;let i=t&&t.color!==n.color?t:void 0;return r===e.selected&&P(e),k(e.events.move,o,r,i),ar(e,o,r)||(e.pieces.set(r,n),e.pieces.delete(o)),e.lastMove=[o,r],e.check=void 0,k(e.events.change),i||!0}function ce(e,o,r,n){if(e.pieces.has(r))if(n)e.pieces.delete(r);else return!1;return k(e.events.dropNewPiece,o,r),e.pieces.set(r,o),e.lastMove=[r],e.check=void 0,k(e.events.change),e.movable.dests=void 0,e.turnColor=F(e.turnColor),!0}function oo(e,o,r){let n=ke(e,o,r);return n&&(e.movable.dests=void 0,e.turnColor=F(e.turnColor),e.animation.current=void 0),n}function xe(e,o,r){if(ae(e,o,r)){let n=oo(e,o,r);if(n){let t=e.hold.stop();P(e);let i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:t};return n!==!0&&(i.captured=n),k(e.movable.events.after,o,r,i),!0}}else if(pr(e,o,r))return cr(e,o,r,{ctrlKey:e.stats.ctrlKey}),P(e),!0;return P(e),!1}function le(e,o,r,n){let t=e.pieces.get(o);t&&(dr(e,o,r)||n)?(e.pieces.delete(o),ce(e,t,r,n),k(e.movable.events.afterNewPiece,t.role,r,{premove:!1,predrop:!1})):t&&ur(e,o,r)?lr(e,t.role,r):(D(e),A(e)),e.pieces.delete(o),P(e)}function J(e,o,r){if(k(e.events.select,o),e.selected){if(e.selected===o&&!e.draggable.enabled){P(e),e.hold.cancel();return}else if((e.selectable.enabled||r)&&e.selected!==o&&xe(e,e.selected,o)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(ro(e,o)||Me(e,o))&&(Ce(e,o),e.hold.start())}function Ce(e,o){e.selected=o,Me(e,o)?e.premovable.customDests||(e.premovable.dests=Pe(e,o)):e.premovable.dests=void 0}function P(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function ro(e,o){let r=e.pieces.get(o);return!!r&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}var ae=(e,o,r)=>o!==r&&ro(e,o)&&(e.movable.free||!!e.movable.dests?.get(o)?.includes(r));function dr(e,o,r){let n=e.pieces.get(o);return!!n&&(o===r||!e.pieces.has(r))&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}function Me(e,o){let r=e.pieces.get(o);return!!r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}var pr=(e,o,r)=>o!==r&&Me(e,o)&&(e.premovable.customDests?.get(o)??Pe(e,o)).includes(r);function ur(e,o,r){let n=e.pieces.get(o),t=e.pieces.get(r);return!!n&&(!t||t.color!==e.movable.color)&&e.predroppable.enabled&&(n.role!=="pawn"||r[1]!=="1"&&r[1]!=="8")&&e.movable.color===n.color&&e.turnColor!==n.color}function no(e,o){let r=e.pieces.get(o);return!!r&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))}function to(e){let o=e.premovable.current;if(!o)return!1;let r=o[0],n=o[1],t=!1;if(ae(e,r,n)){let i=oo(e,r,n);if(i){let c={premove:!0};i!==!0&&(c.captured=i),k(e.movable.events.after,r,n,c),t=!0}}return D(e),t}function io(e,o){let r=e.predroppable.current,n=!1;if(!r)return!1;if(o(r)){let t={role:r.role,color:e.movable.color};ce(e,t,r.key)&&(k(e.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),n=!0)}return A(e),n}function ee(e){D(e),A(e),P(e)}function Se(e){e.movable.color=e.movable.dests=e.animation.current=void 0,ee(e)}function q(e,o,r){let n=Math.floor(8*(e[0]-r.left)/r.width);o||(n=7-n);let t=7-Math.floor(8*(e[1]-r.top)/r.height);return o||(t=7-t),n>=0&&n<8&&t>=0&&t<8?$([n,t]):void 0}function so(e,o,r,n){let t=h(e),i=ge.filter(s=>Ve(t,s)||Ge(t[0],t[1],s[0],s[1])||se(t[0],t[1],s[0],s[1])),p=i.map(s=>ie(z(s),r,n)).map(s=>H(o,s)),[,d]=p.reduce((s,l,a)=>s[0]<l?s:[l,a],[p[0],0]);return $(i[d])}var b=e=>e.orientation==="white";var Ae="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",fr={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},mr={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function de(e){e==="start"&&(e=Ae);let o=new Map,r=7,n=0;for(let t of e)switch(t){case" ":case"[":return o;case"/":if(--r,r<0)return o;n=0;break;case"~":{let i=$([n-1,r]),c=i&&o.get(i);c&&(c.promoted=!0);break}default:{let i=t.charCodeAt(0);if(i<57)n+=i-48;else{let c=t.toLowerCase(),p=$([n,r]);p&&o.set(p,{role:fr[c],color:t===c?"black":"white"}),++n}}}return o}function co(e){return He.map(o=>V.map(r=>{let n=e.get(r+o);if(n){let t=mr[n.role];return n.color==="white"&&(t=t.toUpperCase()),n.promoted&&(t+="~"),t}else return"1"}).join("")).join("/").replace(/1{2,}/g,o=>o.length.toString())}function qe(e,o){o.animation&&(Ee(e.animation,o.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function pe(e,o){if(o.movable?.dests&&(e.movable.dests=void 0),o.drawable?.autoShapes&&(e.drawable.autoShapes=[]),Ee(e,o),o.fen&&(e.pieces=de(o.fen),e.drawable.shapes=o.drawable?.shapes||[]),"check"in o&&eo(e,o.check||!1),"lastMove"in o&&!o.lastMove?e.lastMove=void 0:o.lastMove&&(e.lastMove=o.lastMove),e.selected&&Ce(e,e.selected),qe(e,o),!e.movable.rookCastle&&e.movable.dests){let r=e.movable.color==="white"?"1":"8",n="e"+r,t=e.movable.dests.get(n),i=e.pieces.get(n);if(!t||!i||i.role!=="king")return;e.movable.dests.set(n,t.filter(c=>!(c==="a"+r&&t.includes("c"+r))&&!(c==="h"+r&&t.includes("g"+r))))}}function Ee(e,o){for(let r in o)r==="__proto__"||r==="constructor"||!Object.prototype.hasOwnProperty.call(o,r)||(Object.prototype.hasOwnProperty.call(e,r)&&lo(e[r])&&lo(o[r])?Ee(e[r],o[r]):e[r]=o[r])}function lo(e){if(typeof e!="object"||e===null)return!1;let o=Object.getPrototypeOf(e);return o===Object.prototype||o===null}var R=(e,o)=>o.animation.enabled?vr(e,o):W(e,o);function W(e,o){let r=e(o);return o.dom.redraw(),r}var Te=(e,o)=>({key:e,pos:h(e),piece:o}),gr=(e,o)=>o.sort((r,n)=>H(e.pos,r.pos)-H(e.pos,n.pos))[0];function br(e,o){let r=new Map,n=[],t=new Map,i=[],c=[],p=new Map,d,s,l;for(let[a,m]of e)p.set(a,Te(a,m));for(let a of Y)d=o.pieces.get(a),s=p.get(a),d?s?Q(d,s.piece)||(i.push(s),c.push(Te(a,d))):c.push(Te(a,d)):s&&i.push(s);for(let a of c)s=gr(a,i.filter(m=>Q(a.piece,m.piece))),s&&(l=[s.pos[0]-a.pos[0],s.pos[1]-a.pos[1]],r.set(a.key,l.concat(l)),n.push(s.key));for(let a of i)n.includes(a.key)||t.set(a.key,a.piece);return{anims:r,fadings:t}}function ao(e,o){let r=e.animation.current;if(r===void 0){e.dom.destroyed||e.dom.redrawNow();return}let n=1-(o-r.start)*r.frequency;if(n<=0)e.animation.current=void 0,e.dom.redrawNow();else{let t=wr(n);for(let i of r.plan.anims.values())i[2]=i[0]*t,i[3]=i[1]*t;e.dom.redrawNow(!0),requestAnimationFrame((i=performance.now())=>ao(e,i))}}function vr(e,o){let r=new Map(o.pieces),n=e(o),t=br(r,o);if(t.anims.size||t.fadings.size){let i=o.animation.current&&o.animation.current.start;o.animation.current={start:performance.now(),frequency:1/o.animation.duration,plan:t},i||ao(o,performance.now())}else o.dom.redraw();return n}var wr=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1;var yr=["green","red","blue","yellow"];function po(e,o){if(o.touches&&o.touches.length>1)return;o.stopPropagation(),o.preventDefault(),o.ctrlKey?P(e):ee(e);let r=O(o),n=q(r,b(e),e.dom.bounds());n&&(e.drawable.current={orig:n,pos:r,brush:Pr(o),snapToValidMove:e.drawable.defaultSnapToValidMove},uo(e))}function uo(e){requestAnimationFrame(()=>{let o=e.drawable.current;if(o){let r=q(o.pos,b(e),e.dom.bounds());r||(o.snapToValidMove=!1);let n=o.snapToValidMove?so(o.orig,o.pos,b(e),e.dom.bounds()):r;n!==o.mouseSq&&(o.mouseSq=n,o.dest=n!==o.orig?n:void 0,e.dom.redrawNow()),uo(e)}})}function fo(e,o){e.drawable.current&&(e.drawable.current.pos=O(o))}function mo(e){let o=e.drawable.current;o&&(o.mouseSq&&kr(e.drawable,o),Ke(e))}function Ke(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function ho(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),go(e.drawable))}var ue=(e,o)=>e.orig===o.orig&&e.dest===o.dest,Oe=(e,o)=>e.brush===o.brush;function Pr(e){let o=(e.shiftKey||e.ctrlKey)&&te(e),r=e.altKey||e.metaKey||e.getModifierState?.("AltGraph");return yr[(o?1:0)+(r?2:0)]}function kr(e,o){let r=e.shapes.find(n=>ue(n,o));r&&(e.shapes=e.shapes.filter(n=>!ue(n,o))),(!r||!Oe(r,o))&&e.shapes.push({orig:o.orig,dest:o.dest,brush:o.brush}),go(e)}function go(e){e.onChange&&e.onChange(e.shapes)}function bo(e,o){if(!(e.trustAllEvents||o.isTrusted)||o.buttons!==void 0&&o.buttons>1||o.touches&&o.touches.length>1)return;let r=e.dom.bounds(),n=O(o),t=q(n,b(e),r);if(!t)return;let i=e.pieces.get(t),c=e.selected;if(!c&&e.drawable.enabled&&(e.drawable.eraseOnMovablePieceClick||!i||i.color!==e.turnColor)&&ho(e),o.cancelable!==!1&&(!o.touches||e.blockTouchScroll||i||c||Cr(e,n)))o.preventDefault();else if(o.touches)return;let p=!!e.premovable.current,d=!!e.predroppable.current;e.stats.ctrlKey=o.ctrlKey,e.selected&&ae(e,e.selected,t)?R(a=>J(a,t),e):J(e,t);let s=e.selected===t,l=ko(e,t);if(i&&l&&s&&no(e,t)){e.draggable.current={orig:t,piece:i,origPos:n,pos:n,started:e.draggable.autoDistance&&e.stats.dragged,element:l,previouslySelected:c,originTarget:o.target,keyHasChanged:!1},l.cgDragging=!0,l.classList.add("dragging");let a=e.dom.elements.ghost;a&&(a.className=`ghost ${i.color} ${i.role}`,C(a,I(r)(h(t),b(e))),B(a,!0)),Ne(e)}else p&&D(e),d&&A(e);e.dom.redraw()}function Cr(e,o){let r=b(e),n=e.dom.bounds(),t=Math.pow(e.touchIgnoreRadius*n.width/16,2)*2;for(let i of e.pieces.keys()){let c=ie(i,r,n);if(H(c,o)<=t)return!0}return!1}function vo(e,o,r,n){e.pieces.set("a0",o),e.dom.redraw();let i=O(r);e.draggable.current={orig:"a0",piece:o,origPos:i,pos:i,started:!0,element:()=>ko(e,"a0"),originTarget:r.target,newPiece:!0,force:!!n,keyHasChanged:!1},Ne(e)}function Ne(e){requestAnimationFrame(()=>{let o=e.draggable.current;if(!o)return;e.animation.current?.plan.anims.has(o.orig)&&(e.animation.current=void 0);let r=e.pieces.get(o.orig);if(!r||!Q(r,o.piece))G(e);else if(!o.started&&H(o.pos,o.origPos)>=Math.pow(e.draggable.distance,2)&&(o.started=!0),o.started){if(typeof o.element=="function"){let t=o.element();if(!t)return;t.cgDragging=!0,t.classList.add("dragging"),o.element=t}let n=e.dom.bounds();C(o.element,[o.pos[0]-n.left-n.width/16,o.pos[1]-n.top-n.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==q(o.pos,b(e),n))}Ne(e)})}function wo(e,o){e.draggable.current&&(!o.touches||o.touches.length<2)&&(e.draggable.current.pos=O(o))}function yo(e,o){let r=e.draggable.current;if(!r)return;if(o.type==="touchend"&&o.cancelable!==!1&&o.preventDefault(),o.type==="touchend"&&r.originTarget!==o.target&&!r.newPiece){e.draggable.current=void 0;return}D(e),A(e);let n=O(o)||r.pos,t=q(n,b(e),e.dom.bounds());t&&r.started&&r.orig!==t?r.newPiece?le(e,r.orig,t,r.force):(e.stats.ctrlKey=o.ctrlKey,xe(e,r.orig,t)&&(e.stats.dragged=!0)):r.newPiece?e.pieces.delete(r.orig):e.draggable.deleteOnDropOff&&!t&&(e.pieces.delete(r.orig),k(e.events.change)),(r.orig===r.previouslySelected||r.keyHasChanged)&&(r.orig===t||!t)?P(e):e.selectable.enabled||P(e),Po(e),e.draggable.current=void 0,e.dom.redraw()}function G(e){let o=e.draggable.current;o&&(o.newPiece&&e.pieces.delete(o.orig),e.draggable.current=void 0,P(e),Po(e),e.dom.redraw())}function Po(e){let o=e.dom.elements;o.ghost&&B(o.ghost,!1)}function ko(e,o){let r=e.dom.elements.board.firstChild;for(;r;){if(r.cgKey===o&&r.tagName==="PIECE")return r;r=r.nextSibling}}function Co(e,o){e.exploding={stage:1,keys:o},e.dom.redraw(),setTimeout(()=>{xo(e,2),setTimeout(()=>xo(e,void 0),120)},120)}function xo(e,o){e.exploding&&(o?e.exploding.stage=o:e.exploding=void 0,e.dom.redraw())}function Mo(e,o){function r(){Qe(e),o()}return{set(n){n.orientation&&n.orientation!==e.orientation&&r(),qe(e,n),(n.fen?R:W)(t=>pe(t,n),e)},state:e,getFen:()=>co(e.pieces),toggleOrientation:r,setPieces(n){R(t=>Je(t,n),e)},selectSquare(n,t){n?R(i=>J(i,n,t),e):e.selected&&(P(e),e.dom.redraw())},move(n,t){R(i=>ke(i,n,t),e)},newPiece(n,t){R(i=>ce(i,n,t),e)},playPremove(){if(e.premovable.current){if(R(to,e))return!0;e.dom.redraw()}return!1},playPredrop(n){if(e.predroppable.current){let t=io(e,n);return e.dom.redraw(),t}return!1},cancelPremove(){W(D,e)},cancelPredrop(){W(A,e)},cancelMove(){W(n=>{ee(n),G(n)},e)},stop(){W(n=>{Se(n),G(n)},e)},explode(n){Co(e,n)},setAutoShapes(n){W(t=>t.drawable.autoShapes=n,e)},setShapes(n){W(t=>t.drawable.shapes=n.slice(),e)},getKeyAtDomPos(n){return q(n,b(e),e.dom.bounds())},redrawAll:o,dragNewPiece(n,t,i){vo(e,n,t,i)},destroy(){Se(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function So(){return{pieces:de(Ae),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,touchIgnoreRadius:1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,additionalPremoveRequirements:e=>!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnMovablePieceClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10},paleWhite:{key:"pwhite",color:"white",opacity:.6,lineWidth:10}},prevSvgHash:""},hold:je()}}function Eo(){let e=v("defs"),o=y(v("filter"),{id:"cg-filter-blur"});return o.appendChild(y(v("feGaussianBlur"),{stdDeviation:"0.013"})),e.appendChild(o),e}function To(e,o){let r=e.drawable,n=r.current,t=n&&n.mouseSq?n:void 0,i=new Map,c=e.dom.bounds(),p=r.autoShapes.filter(a=>!a.piece);for(let a of r.shapes.concat(p).concat(t?[t]:[])){if(!a.dest)continue;let m=i.get(a.dest)??new Set,f=me(fe(h(a.orig),e.orientation),c),u=me(fe(h(a.dest),e.orientation),c);m.add(Lo($o(f,u))),i.set(a.dest,m)}let d=[],s=t?r.shapes.findIndex(a=>ue(a,t)&&Oe(a,t)):-1;for(let[a,m]of r.shapes.concat(p).entries()){let f=s!==-1&&s===a;d.push({shape:m,current:!1,pendingErase:f,hash:Do(m,Be(m.dest,i),!1,c,f,qo(m.dest,i))})}t&&s===-1&&d.push({shape:t,current:!0,hash:Do(t,Be(t.dest,i),!0,c,!1,qo(t.dest,i)),pendingErase:!1});let l=d.map(a=>a.hash).join(";");l!==e.drawable.prevSvgHash&&(e.drawable.prevSvgHash=l,Sr(r,d,o),Dr(d,o,a=>Er(e,a,r.brushes,i,c)))}function Sr(e,o,r){for(let n of[r.shapes,r.shapesBelow]){let t=n.querySelector("defs"),i=o.filter(s=>n===r.shapesBelow==!!s.shape.below),c=new Map;for(let s of i.filter(l=>l.shape.dest&&l.shape.brush)){let l=Bo(e.brushes[s.shape.brush],s.shape.modifiers),{key:a,color:m}=Ro(s.shape);a&&m&&c.set(a,{key:a,color:m,opacity:1,lineWidth:1}),c.set(l.key,l)}let p=new Set,d=t.firstElementChild;for(;d;)p.add(d.getAttribute("cgKey")),d=d.nextElementSibling;for(let[s,l]of c.entries())p.has(s)||t.appendChild(Or(l))}}function Dr(e,o,r){for(let[n,t]of[[o.shapes,o.custom],[o.shapesBelow,o.customBelow]]){let[i,c]=[n,t].map(s=>s.querySelector("g")),p=e.filter(s=>n===o.shapesBelow==!!s.shape.below),d=new Map;for(let s of p)d.set(s.hash,!1);for(let s of[i,c]){let l=[],a=s.firstElementChild,m;for(;a;)m=a.getAttribute("cgHash"),d.has(m)?d.set(m,!0):l.push(a),a=a.nextElementSibling;for(let f of l)s.removeChild(f)}for(let s of p.filter(l=>!d.get(l.hash)))for(let l of r(s))l.isCustom?c.appendChild(l.el):i.appendChild(l.el)}}function Do({orig:e,dest:o,brush:r,piece:n,modifiers:t,customSvg:i,label:c,below:p},d,s,l,a,m){return[l.width,l.height,s,a&&"pendingErase",m,e,o,r,d&&"-",n&&Ar(n),t&&qr(t),i&&`custom-${Ao(i.html)},${i.center?.[0]??"o"}`,c&&`label-${Ao(c.text)}`,p&&"below"].filter(f=>f).join(",")}var Ar=e=>[e.color,e.role,e.scale].filter(o=>o).join(","),qr=e=>[e.lineWidth,e.hilite].filter(o=>o).join(",");function Ao(e){let o=0;for(let r=0;r<e.length;r++)o=(o<<5)-o+e.charCodeAt(r)>>>0;return o.toString()}function Er(e,{shape:o,current:r,pendingErase:n,hash:t},i,c,p){let d=me(fe(h(o.orig),e.orientation),p),s=o.dest?me(fe(h(o.dest),e.orientation),p):d,l=o.brush&&Bo(i[o.brush],o.modifiers),a=c.get(o.dest),m=[];if(l){let f=y(v("g"),{cgHash:t});m.push({el:f}),d[0]!==s[0]||d[1]!==s[1]?f.appendChild(Kr(o,l,d,s,r,Be(o.dest,c),n)):f.appendChild(Tr(i[o.brush],d,r,p,n))}if(o.label){let f=o.label;f.fill??(f.fill=o.brush&&i[o.brush].color);let u=o.brush?void 0:"tr";m.push({el:Nr(f,t,d,s,a,u),isCustom:!0})}if(o.customSvg){let f=o.customSvg.center??"orig",[u,E]=f==="label"?zo(d,s,a).map(w=>w-.5):f==="dest"?s:d,S=y(v("g"),{transform:`translate(${u},${E})`,cgHash:t});S.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${o.customSvg.html}</svg>`,m.push({el:S,isCustom:!0})}return m}function Tr(e,o,r,n,t){let i=Br(),c=(n.width+n.height)/(4*Math.max(n.width,n.height));return y(v("circle"),{stroke:e.color,"stroke-width":i[r?0:1],fill:"none",opacity:Wo(e,r,t),cx:o[0],cy:o[1],r:c-i[1]/2})}function Kr(e,o,r,n,t,i,c){function p(l){let a=Wr(i&&!t),m=n[0]-r[0],f=n[1]-r[1],u=Math.atan2(f,m),E=Math.cos(u)*a,S=Math.sin(u)*a,w=Ro(e);return y(v("line"),{stroke:l?w.color:o.color,"stroke-width":Rr(o,t)*(l?1.14:1),"stroke-linecap":"round","marker-end":`url(#arrowhead-${l?w.key:o.key})`,opacity:e.modifiers?.hilite&&!c?1:Wo(o,t,c),x1:r[0],y1:r[1],x2:n[0]-E,y2:n[1]-S})}if(!e.modifiers?.hilite)return p(!1);let d=y(v("g"),{opacity:o.opacity}),s=y(v("g"),{filter:"url(#cg-filter-blur)"});return s.appendChild(Lr(r,n)),s.appendChild(p(!0)),d.appendChild(s),d.appendChild(p(!1)),d}function Or(e){let o=y(v("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return o.appendChild(y(v("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),o.setAttribute("cgKey",e.key),o}function Nr(e,o,r,n,t,i){let p=.4*.75**e.text.length,d=zo(r,n,t),s=i==="tr"?.4:0,l=y(v("g"),{transform:`translate(${d[0]+s},${d[1]-s})`,cgHash:o});l.appendChild(y(v("circle"),{r:.4/2,"fill-opacity":i?1:.8,"stroke-opacity":i?1:.7,"stroke-width":.03,fill:e.fill??"#666",stroke:"white"}));let a=y(v("text"),{"font-size":p,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return a.innerHTML=e.text,l.appendChild(a),l}var fe=(e,o)=>o==="white"?e:[7-e[0],7-e[1]],Ko=(e,o)=>(e%o+o)%o,Oo=(e,o)=>Ko(e+o,16),No=e=>[...e].some(o=>[-3,-2,-1,1,2,3].some(r=>e.has(Oo(o,r)))),Be=(e,o)=>!!e&&o.has(e)&&No(o.get(e)),v=e=>document.createElementNS("http://www.w3.org/2000/svg",e),qo=(e,o)=>e&&o.has(e)?o.get(e).size:0;function y(e,o){for(let r in o)Object.prototype.hasOwnProperty.call(o,r)&&e.setAttribute(r,o[r]);return e}var Bo=(e,o)=>o?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(o.lineWidth||e.lineWidth),key:[e.key,o.lineWidth].filter(r=>r).join("")}:e,Br=()=>[3/64,4/64],Rr=(e,o)=>(e.lineWidth||10)*(o?.85:1)/64;function Ro(e){let o=e.modifiers?.hilite;return{key:o&&`hilite-${o.replace("#","")}`,color:o}}var Wo=(e,o,r)=>(e.opacity||1)*(r?.6:o?.9:1),Wr=e=>(e?20:10)/64;function me(e,o){let r=Math.min(1,o.width/o.height),n=Math.min(1,o.height/o.width);return[(e[0]-3.5)*r,(3.5-e[1])*n]}function Lr(e,o){let r={from:[Math.floor(Math.min(e[0],o[0])),Math.floor(Math.min(e[1],o[1]))],to:[Math.ceil(Math.max(e[0],o[0])),Math.ceil(Math.max(e[1],o[1]))]};return y(v("rect"),{x:r.from[0],y:r.from[1],width:r.to[0]-r.from[0],height:r.to[1]-r.from[1],fill:"none",stroke:"none"})}var Lo=e=>Ko(Math.round(e*8/Math.PI),16),$o=(e,o)=>Math.atan2(o[1]-e[1],o[0]-e[0])+Math.PI,$r=(e,o)=>Math.sqrt([e[0]-o[0],e[1]-o[1]].reduce((r,n)=>r+n*n,0));function zo(e,o,r){let n=$r(e,o),t=$o(e,o);if(r&&(n-=33/64,No(r))){n-=10/64;let i=Lo(t);i&1&&[-1,1].some(c=>r.has(Oo(i,c)))&&(n-=.4)}return[e[0]-Math.cos(t)*n,e[1]-Math.sin(t)*n].map(i=>i+.5)}function Ho(e,o){e.innerHTML="",e.classList.add("cg-wrap");for(let l of ze)e.classList.toggle("orientation-"+l,o.orientation===l);e.classList.toggle("manipulable",!o.viewOnly);let r=M("cg-container");e.appendChild(r);let n=M("cg-board");r.appendChild(n);let t,i,c,p,d;if(o.drawable.visible&&([t,i]=["cg-shapes-below","cg-shapes"].map(l=>Fo(l,!0)),[c,p]=["cg-custom-below","cg-custom-svgs"].map(l=>Fo(l,!1)),d=M("cg-auto-pieces"),r.appendChild(t),r.appendChild(c),r.appendChild(i),r.appendChild(p),r.appendChild(d)),o.coordinates){let l=o.orientation==="black"?" black":"",a=o.ranksPosition==="left"?" left":"";if(o.coordinatesOnSquares){let m=o.orientation==="white"?f=>f+1:f=>8-f;V.forEach((f,u)=>r.appendChild(Re(Z.map(E=>f+E),"squares rank"+m(u)+l+a,u%2===0?"black":"white")))}else r.appendChild(Re(Z,"ranks"+l+a,o.ranksPosition==="right"==(o.orientation==="white")?"white":"black")),r.appendChild(Re(V,"files"+l,F(o.orientation)))}let s;return!o.viewOnly&&o.draggable.enabled&&o.draggable.showGhost&&(s=M("piece","ghost"),B(s,!1),r.appendChild(s)),{board:n,container:r,wrap:e,ghost:s,shapes:i,shapesBelow:t,custom:p,customBelow:c,autoPieces:d}}function Fo(e,o){let r=y(v("svg"),{class:e,viewBox:o?"-4 -4 8 8":"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"});return o&&r.appendChild(Eo()),r.appendChild(v("g")),r}function Re(e,o,r){let n=M("coords",o),t;return e.forEach((i,c)=>{let p=c%2===(r==="white"?0:1);t=M("coord",`coord-${p?"light":"dark"}`),t.textContent=i,n.appendChild(t)}),n}function Io(e,o){if(!e.dropmode.active)return;D(e),A(e);let r=e.dropmode.piece;if(r){e.pieces.set("a0",r);let n=O(o),t=n&&q(n,b(e),e.dom.bounds());t&&le(e,"a0",t)}e.dom.redraw()}function Vo(e,o){let r=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(o).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&r.addEventListener("contextmenu",t=>t.preventDefault()),e.viewOnly)return;let n=Fr(e);r.addEventListener("touchstart",n,{passive:!1}),r.addEventListener("mousedown",n,{passive:!1})}function Go(e,o){let r=[];if("ResizeObserver"in window||r.push(oe(document.body,"chessground.resize",o)),!e.viewOnly){let n=jo(e,wo,fo),t=jo(e,yo,mo);for(let c of["touchmove","mousemove"])r.push(oe(document,c,n));for(let c of["touchend","mouseup"])r.push(oe(document,c,t));let i=()=>e.dom.bounds.clear();r.push(oe(document,"scroll",i,{capture:!0,passive:!0})),r.push(oe(window,"resize",i,{passive:!0}))}return()=>r.forEach(n=>n())}function oe(e,o,r,n){return e.addEventListener(o,r,n),()=>e.removeEventListener(o,r,n)}var Fr=e=>o=>{e.draggable.current?G(e):e.drawable.current?Ke(e):o.shiftKey||te(o)?e.drawable.enabled&&po(e,o):e.viewOnly||(e.dropmode.active?Io(e,o):bo(e,o))},jo=(e,o,r)=>n=>{e.drawable.current?e.drawable.enabled&&r(e,n):e.viewOnly||o(e,n)};function Zo(e){let o=b(e),r=I(e.dom.bounds()),n=e.dom.elements.board,t=e.pieces,i=e.animation.current,c=i?i.plan.anims:new Map,p=i?i.plan.fadings:new Map,d=e.draggable.current,s=new Set,l=new Map,a=Vr(e),m=new Map,f,u,E,S,w,U,he,T,X;for(u=n.firstChild;u;){if(f=u.cgKey,Uo(u))if(E=t.get(f),w=c.get(f),U=p.get(f),S=u.cgPiece,u.cgDragging&&(!d||d.orig!==f)&&(u.classList.remove("dragging"),C(u,r(h(f),o)),u.cgDragging=!1),!U&&u.cgFading&&(u.cgFading=!1,u.classList.remove("fading")),E){if(w&&u.cgAnimating&&S===re(E)){let g=h(f);g[0]+=w[2],g[1]+=w[3],u.classList.add("anim"),C(u,r(g,o))}else u.cgAnimating&&(u.cgAnimating=!1,u.classList.remove("anim"),C(u,r(h(f),o)),e.addPieceZIndex&&(u.style.zIndex=We(h(f),o)));S===re(E)&&(!U||!u.cgFading)?s.add(f):U&&S===re(U)?(u.classList.add("fading"),u.cgFading=!0):Le(l,S,u)}else Le(l,S,u);else if(Xo(u)){let g=u.className;a.get(f)===g?(B(u,!0),a.delete(f)):Le(m,g,u)}u=u.nextSibling}for(let[g,j]of a){X=m.get(j)?.pop();let x=r(h(g),o);if(X)X.cgKey=g,C(X,x),B(X,!0);else{let K=M("square",j);K.cgKey=g,C(K,x),n.insertBefore(K,n.firstChild)}}for(let[g,j]of m.entries())for(let x of j)B(x,!1);for(let[g,j]of t)if(w=c.get(g),!s.has(g))if(he=l.get(re(j)),T=he&&he.pop(),T){T.cgKey=g,T.cgFading&&(T.classList.remove("fading"),T.cgFading=!1);let x=h(g);e.addPieceZIndex&&(T.style.zIndex=We(x,o)),w&&(T.cgAnimating=!0,T.classList.add("anim"),x[0]+=w[2],x[1]+=w[3]),C(T,r(x,o))}else{let x=re(j),K=M("piece",x),ne=h(g);K.cgPiece=x,K.cgKey=g,w&&(K.cgAnimating=!0,ne[0]+=w[2],ne[1]+=w[3]),C(K,r(ne,o)),e.addPieceZIndex&&(K.style.zIndex=We(ne,o)),n.appendChild(K)}for(let g of l.values())Ir(e,g)}function _o(e){let o=b(e),r=I(e.dom.bounds()),n=e.dom.elements.board.firstChild;for(;n;)(Uo(n)&&!n.cgAnimating||Xo(n))&&C(n,r(h(n.cgKey),o)),n=n.nextSibling}function $e(e){let o=e.dom.elements.wrap.getBoundingClientRect(),r=e.dom.elements.container,n=o.height/o.width,t=Math.floor(o.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,i=t*n;r.style.width=t+"px",r.style.height=i+"px",e.dom.bounds.clear(),e.addDimensionsCssVarsTo?.style.setProperty("---cg-width",t+"px"),e.addDimensionsCssVarsTo?.style.setProperty("---cg-height",i+"px")}var Uo=e=>e.tagName==="PIECE",Xo=e=>e.tagName==="SQUARE";function Ir(e,o){for(let r of o)e.dom.elements.board.removeChild(r)}function We(e,o){let n=e[1];return`${o?10-n:3+n}`}var re=e=>`${e.color} ${e.role}`,jr=(e,o)=>e.lastMove?.[1]&&!e.pieces.has(e.lastMove[1])&&e.lastMove[0][0]==="e"&&["h","a"].includes(e.lastMove[1][0])&&e.lastMove[0][1]===e.lastMove[1][1]&&Ue(...h(e.lastMove[0]),...h(e.lastMove[1])).some(r=>e.pieces.has(r))?(o>e.lastMove[0]?"g":"c")+o[1]:o;function Vr(e){let o=new Map;if(e.lastMove&&e.highlight.lastMove)for(let[t,i]of e.lastMove.entries())L(o,t===1?jr(e,i):i,"last-move");if(e.check&&e.highlight.check&&L(o,e.check,"check"),e.selected&&(L(o,e.selected,"selected"),e.movable.showDests)){for(let t of e.movable.dests?.get(e.selected)??[])L(o,t,"move-dest"+(e.pieces.has(t)?" oc":""));for(let t of e.premovable.customDests?.get(e.selected)??e.premovable.dests??[])L(o,t,"premove-dest"+(e.pieces.has(t)?" oc":""))}let r=e.premovable.current;if(r)for(let t of r)L(o,t,"current-premove");else e.predroppable.current&&L(o,e.predroppable.current.key,"current-premove");let n=e.exploding;if(n)for(let t of n.keys)L(o,t,"exploding"+n.stage);return e.highlight.custom&&e.highlight.custom.forEach((t,i)=>{L(o,i,t)}),o}function L(e,o,r){let n=e.get(o);n?e.set(o,`${n} ${r}`):e.set(o,r)}function Le(e,o,r){let n=e.get(o);n?n.push(r):e.set(o,[r])}function Yo(e,o,r){let n=new Map,t=[];for(let p of e)n.set(p.hash,!1);let i=o.firstElementChild,c;for(;i;)c=i.getAttribute("cgHash"),n.has(c)?n.set(c,!0):t.push(i),i=i.nextElementSibling;for(let p of t)o.removeChild(p);for(let p of e)n.get(p.hash)||o.appendChild(r(p))}function Qo(e,o){let n=e.drawable.autoShapes.filter(t=>t.piece).map(t=>({shape:t,hash:Zr(t),current:!1,pendingErase:!1}));Yo(n,o,t=>Gr(e,t,e.dom.bounds()))}function Jo(e){let o=b(e),r=I(e.dom.bounds()),n=e.dom.elements.autoPieces?.firstChild;for(;n;)ve(n,r(h(n.cgKey),o),n.cgScale),n=n.nextSibling}function Gr(e,{shape:o,hash:r},n){let t=o.orig,i=o.piece?.role,c=o.piece?.color,p=o.piece?.scale,d=M("piece",`${i} ${c}`);return d.setAttribute("cgHash",r),d.cgKey=t,d.cgScale=p,ve(d,I(n)(h(t),b(e)),p),d}var Zr=e=>[e.orig,e.piece?.role,e.piece?.color,e.piece?.scale].join(",");function er(e,o){let r=So();pe(r,o||{});function n(){let t="dom"in r?r.dom.unbind:void 0,i=Ho(e,r),c=be(()=>i.board.getBoundingClientRect()),p=l=>{Zo(s),i.autoPieces&&Qo(s,i.autoPieces),!l&&i.shapes&&To(s,i)},d=()=>{$e(s),_o(s),i.autoPieces&&Jo(s)},s=r;return s.dom={elements:i,bounds:c,redraw:Ur(p),redrawNow:p,unbind:t},s.drawable.prevSvgHash="",$e(s),p(!1),Vo(s,d),t||(s.dom.unbind=Go(s,d)),s.events.insert&&s.events.insert(i),s}return Mo(n(),n)}function Ur(e){let o=!1;return()=>{o||(o=!0,requestAnimationFrame(()=>{e(),o=!1}))}}window.Chessground=er;})();
